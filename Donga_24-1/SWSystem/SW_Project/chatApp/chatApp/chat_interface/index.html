<!DOCTYPE html>
<html>
<head>

  <title>Chat App</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="whidth=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <link rel="stylesheet" href="style.css">

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous">
  </script>

</head>
<body>
  <div id="chat">
    <div class="chat-interface">

      <div class="chat-title-container">
        <nav class="chat-title-container-color">
          <span class="chat-title">SW Chat</span>
          <span class = "badge bg-dark" id = "badge">ğŸŒ Dark</span>
        </nav>
      </div>

      <div class="chat-container">
        <div id="chat-message-view"></div>
      </div>

      <div class="chat-write-container">
        <div class="wirter-nickname-container">
          <input type="test" id="nickname-input" placeholder="Nickname"/>
        </div>

        <div class="message-container">
          <input type="test" id="message-input" placeholder="Message..." onkeydown="handleSendEnter(event)"/>
        </div>

        <div class="send-message-button-container">
          <button id="send-message-button" onclick="sendNicknameMessage()">
        </div>

      </div>
    </div>
  </div>    


  <script>
    // ë‹¤í¬ & ë¼ì´íŠ¸ ëª¨ë“œ ë³€ê²½í•˜ëŠ” script
      var count = 0;

      $('.badge').on('click', function(){
        
        count++;

        if(count % 2){
          $('#badge').html('ğŸŒ Light');
          $('#chat-message-view').addClass('dark');
        } else {
          $('#badge').html('ğŸŒ Dark');
          $('#chat-message-view').removeClass('dark');
        }
      })
  </script>

  <script>
      const ws = new WebSocket('ws://localhost:8080');
      const chat = document.getElementById('chat-message-view');      // html idê°€ chat-message-viewì¸ íƒœê·¸ë¥¼ ì˜ë¯¸
      const nicknameInput = document.getElementById('nickname-input');// ì…ë ¥í•œ ë‹‰ë„¤ì„ì„ ë°›ëŠ” ë³€ìˆ˜
      const messageInput = document.getElementById('message-input');  // ì…ë ¥í•œ ë©”ì‹œì§€ë¥¼ ë°›ëŠ” ë³€ìˆ˜
      const chatMessageView = document.getElementById('chat-message-view'); // chat-message-view ìš”ì†Œë¥¼ ë°›ëŠ” ë³€ìˆ˜ - ìŠ¤í¬ë¡¤ ê´€ë ¨

      ws.onmessage = function(event) {
        // event.dataê°€ Blob ì¸ìŠ¤í„´ìŠ¤ì¼ ê²½ìš° FileReaderë¥¼ ì‚¬ìš©í•´ì„œ ì½ì–´ì˜¤ê¸°
        if (event.data instanceof Blob) {
          const reader = new FileReader();
          reader.onload = function() {
            const message = document.createElement('p');
            message.innerHTML = reader.result;
            chat.appendChild(message);
            scrollToBottom(); // ìŠ¤í¬ë¡¤ ê´€ë ¨
          };
          reader.readAsText(event.data);
        } else {
          // ë©”ì‹œì§€ê°€ ë¬¸ìì—´ì¸ ê²½ìš°, ì§ì ‘ í‘œì‹œ
          const message = document.createElement('p');
          message.innerHTML = event.data;
          chat.appendChild(message);
          scrollToBottom(); // ìŠ¤í¬ë¡¤ ê´€ë ¨
        }
      };

      // ë©”ì„¸ì§€ì™€ ë‹‰ë„¤ì„ì„ wsì— ë³´ë‚´ëŠ” í•¨ìˆ˜
      function sendNicknameMessage() {
      
        let nickname = nicknameInput.value.trim();
        const message = messageInput.value.trim();
        
        if (!message) {
          alert("ë©”ì„¸ì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
          return;
        }
        
        if (!nickname) nickname = "ìµëª…"; // ë§Œì•½ ë‹‰ë„¤ì„ì´ ì—†ë‹¤ë©´ ìµëª…ì´ë¼ê³  í‘œì‹œ

        const nickNameMessage = 
          `<span class="nickname-design">${nickname}</span><br> ${message}`;

        // ë‹‰ë„¤ì„ê³¼ ë©”ì„¸ì§€ë¥¼ ê°ê° ì „ì†¡
        ws.send(nickNameMessage);
        
        nicknameInput.value = '';
        messageInput.value = '';
      }


      // inputíƒœê·¸ì—ì„œ Enterë¥¼ ëˆ„ë¥¼ ê²½ìš° ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
      function handleSendEnter(event) {
        if (event.key !== 'Enter') return;  // Enter í‚¤ê°€ ì•„ë‹Œ ê²½ìš° í•¨ìˆ˜ ì¢…ë£Œ(ì—ëŸ¬ ì²˜ë¦¬)

        const sendButton = document.getElementById('send-message-button'); // buttoníƒœê·¸ë¥¼ ë³€ìˆ˜ë¡œ ë°›ìŒ
        if (!sendButton) return;            // sendButtonì´ ì—†ëŠ” ê²½ìš° í•¨ìˆ˜ ì¢…ë£Œ(ì—ëŸ¬ ì²˜ë¦¬)

        sendButton.click();                 // sendButtonì„ í´ë¦­í•´ì„œ ì‹¤í–‰
      }

      // ìŠ¤í¬ë¡¤ì„ ê°€ì¥ ì•„ë˜ìª½ìœ¼ë¡œ ì„¤ì •í•˜ëŠ” í•¨ìˆ˜(ìµœì‹  ë©”ì‹œì§€ë¥¼ ë³´ì´ê²Œ í•˜ê¸° ìœ„í•¨)
      function scrollToBottom() {
        chatMessageView.scrollTop = chatMessageView.scrollHeight;
      }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous">
  </script>

</body>
</html>

